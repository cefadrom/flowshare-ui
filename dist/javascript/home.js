"use strict";$(function(){function a(a,b,c){return a?void A.text(b).css("backgroundColor",c).fadeIn():A.fadeOut()}function b(){C=750>v}function c(a){C&&(a?($("#logo-big, #header-account").fadeOut(200),$("#search-box").css({width:"280px",right:"calc((100% - 280px) / 2)"}),$("#search-txt").css("width","230px"),D.show(),setTimeout(function(){var a=$("#search-txt").trigger("focus").get(0);console.log(a),a.setSelectionRange(999999,999999)},100)):($("#logo-big, #header-account").fadeIn(200),$("#search-box").css({width:"auto",right:"120px"}).trigger("blur"),$("#search-txt").css("width","0"),D.hide()))}function d(a){function b(b,c){if($("#search-txt").val()===a)return D.css("padding","8px").html(""),c?D.append($("<div class=\"result\" style=\"cursor: default;\"></div>").text(c)):void($.each(b,function(a,b){D.append($("<div class=\"result\" data-flow-index=\"".concat(a,"\" data-flow-id=\"").concat(b.id,"\"></div>")).text(b.title))}),$(".result").off("flowshare.click").on("click.flowshare",function(){var a=E[$(this).attr("data-flow-index")],b=$(this).attr("data-flow-id");p(a,b)}))}return 31<a.length?b(null,"Text is too long"):void $.ajax({method:"GET",url:"".concat(y.api,"search.php?instant&text=").concat(encodeURI(a)),timeout:2e3,success:function success(a){var c;try{c=JSON.parse(a)}catch(a){return b(null,"JSON parse error")}return c.error?b(null,c.error):void(E=c,b(c))},error:function error(){b(null,"AJAX error")}})}function e(a){if(!a.match(/^[ ]*$/)){F.search=a;var b=new URLSearchParams;$.each(F,function(a,c){b.append(a,c)}),window.location.search=b.toString()}}function f(){$("#flow-search-back-arrow").off("click.flowshare").on("click.flowshare",function(){j(!0)})}function g(a,b,c){var d=!1;return"filter"===c?I.each(function(){$(this).attr("data-filter-value")!==b||($(this).parent().children(".response").css("backgroundColor","transparent"),$(this).css("backgroundColor","#fdcb6e"),d=!0)}):"search"==c&&($("#search-txt").val(b),d=!0),d}function h(){1e3>v?(i(!0),K=!0,$("#nav-arrow").show()):(i(!1),K=!1,$("#nav-arrow").hide()),J=100>$("nav").width()}function i(a){K&&(a?($("nav").css("height","60px"),$("#nav-arrow").removeClass("active")):($("nav").css("height","310px"),$("#nav-arrow").addClass("active")),setTimeout(u,400))}function j(a){var b=new URLSearchParams;delete F.search,$.each(F,function(a,c){null!==c&&b.append(a,c)}),a?window.location.search=b.toString():""===b.toString()?history.pushState({},"","./"):history.pushState({},"","?".concat(b.toString()))}function k(a){var b={offset:L};"rated"===a&&(b.rated=1),$.ajax({type:"GET",url:"".concat(y.api,"flows.php"),data:b,timeout:5e3,success:function success(a){if(m(a)){var b=m(a);M=M.concat(b),n()}},error:function error(){$("#flows-loading").html("Error when getting flows list: AJAX error<br>Please reload page or contact the site administrator.")}})}function l(a){$.ajax({type:"GET",url:"".concat(y.api,"search.php"),data:{text:a,offset:L},timeout:5e3,success:function success(b){if(m(b)){var c=m(b);M=M.concat(c),n("result(s)</span> for ".concat(a),!0,!0)}},error:function error(){$("#flows-loading").html("Error when getting flows list: AJAX error<br>Please reload page or contact the site administrator.")}})}function m(a){var b;try{b=JSON.parse(a)}catch(b){return $("#flows-loading").html("JSON Parse error<br>Error: <br>".concat(b,"<br>Response body:<br>").concat(a)),!1}return b.error?(O.prepend("<i class=\"fas fa-chevron-circle-left back-arrow\" id=\"flow-search-back-arrow\" style=\"top: 5px; left: 5px\"></i>"),f(),$("#flows-loading").html("Error: ".concat(b.error)),!1):b}function n(a,b,c){var d=M;if(N=d,O.text(""),a){var e=b?"".concat(d.length," "):"",g=c?"<i class=\"fas fa-chevron-circle-left back-arrow\" id=\"flow-search-back-arrow\"></i>":"";O.append($("<div class=\"header\">".concat(g).concat(e).concat(a,"</div><hr>"))),c&&f()}$.each(d,function(a,b){var c=$("<div class=\"flow-container\"></div>").attr("data-flow-id",b.id).attr("data-flow-index",a);c.append($("<div class=\"flow-title\"></div>").text(b.title)),c.append($("<div class=\"flow-author\"></div>").text(b.user)),c.append($("<div class=\"flow-description\"></div>").text(b.description)),c.append($("<div class=\"flow-downloads\"></div>").append($("<i class=\"fas fa-download\"></i>").append($("<span class=\"number-container\"></span>").text(b.downloads)))),c.append($("<div class=\"flow-rating\"></div>").append($("<i class=\"far fa-star\"></i>").append($("<span class=\"number-container\"></span>").text(b.ratings)))),O.append(c),$(".flow-container:odd").css("backgroundColor","#E5E5E5"),o()}),u()}function o(){$(".flow-container").off("click.flowshare").on("click.flowshare",function(){var a=parseInt($(this).attr("data-flow-index")),b=$(this).attr("data-flow-id"),c=N[a];p(c,b)})}function p(a,b){$("#flow-data").html("").append($("<i class=\"fas fa-chevron-circle-left back-arrow\" id=\"full-flow-data-back-arrow\"></i>")).append($("<div class=\"flow-title\"></div>").text(a.title)).append($("<div class=\"flow-author\"></div>").text(a.user)).append($("<div class=\"flow-description\"></div>").text(a.description)).append($("<div id=\"flow-data-bar\" style=\"margin-bottom: 20px\"></div>").append($("<div></div>").append($("<i class=\"fas fa-download\"></i>").append($("<span class=\"number-container\"></span>").text(a.downloads)))).append($("<div></div>").append($("<i class=\"far fa-star\"></i>").append($("<span class=\"number-container\"></span>").text(a.ratings)))).append($("<div id=\"download-button\"><i class=\"fas fa-file-download\"></i>  Download</div>")).append($("<div style=\"float: none\" id=\"review-button\"><i class=\"fas fa-user-plus\"></i>  Add review</div>"))).css("opacity",1).css("pointerEvents","all"),$("#download-button").off("click.flowshare").on("click.flowshare",function(){t(b,a.title)}),r(),O.css("opacity",0),1e3>v&&$("nav").css("opacity",0),x.css("pointerEvents","none"),$("header").css("pointerEvents","all"),q(),$.ajax({url:"".concat(y.api,"reviews.php?view&id=").concat(b),method:"GET",timeout:4e3,success:function success(a){var b;try{b=JSON.parse(a)}catch(b){return s(null,a)}s(b)},error:function error(a){404===a.status||$("#flow-data").append($("<div class=\"rating-container\">Error when getting flow reviews : <br>AJAX error code ".concat(a.status,"</div>")))}}),F.id=b,j(!1)}function q(){$("#full-flow-data-back-arrow").off("click.flowshare").on("click.flowshare",function(){o(),$("#flow-list-container, nav").css("opacity",1),x.css("pointerEvents","all"),$("#flow-data").css("opacity",0).css("pointerEvents","none").html(""),delete F.id,j(!1)})}function r(){var a=$("#review-button");900>v||1e3<v&&1350>v?a.css("left","6%"):a.css("left","0")}function s(a,b){if(null!==a){var c=$("#flow-data");b&&c.append($("<div class=\"rating-container\">JSON Parsing error<br>Response body:<br>".concat(b,"</div>"))),"none"===x.css("pointerEvents")&&0<a.length&&(c.append($("<div style=\"position: relative; margin: 20px; font-size: 25px; font-weight: 600\">Ratings</div>")),$.each(a,function(a,b){c.append($("<div class=\"rating-container\"></div>").append($("<div class=\"rating-title\"></div>").text(b.username).append("1"===b.isedited?" <span style=\"opacity: .5; font-weight: lighter; margin-left: 10px\">(edited)</span>":"")).append($("<div class=\"rating-body\"></div>").text(b.comment)))}),$(".rating-container:even").css("backgroundColor","#E5E5E5"))}}function t(a,b){$.ajax({method:"GET",url:"".concat(y.api,"flows.php/id/").concat(a,"?data&base64"),timeout:1e4,success:function success(a){var c=document.createElement("a");c.setAttribute("href","data:application/octet-stream;charset=utf-8;base64,".concat(a)),c.setAttribute("download","".concat(b,".flo")),c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)},error:function error(a){alert("Download error : ".concat(a))}})}function u(){var a=$("footer"),b=$("nav"),c=b.position().top+(b.height()||200)+100,d=O.position().top+(O.height()||0)+100,e=Math.max(c,d);e<w-85?a.css({position:"absolute"}):a.css({position:"relative"})}var v=$(window).width(),w=$(window).height(),x=$("body"),y={homepage:"https://rasphost.com/flowshare/web/test/home/",homepageDir:"/flowshare/web/test/home/",api:"https://rasphost.com/flowshare/"};$(window).on("resize",function(){v=$(window).width(),w=$(window).height(),b(),h(),r(),u()});var z=Cookies.getJSON("account"),A=$("#header-account-popup"),B=$("#header-account-user");z&&z.token&&(B.text("Connecting..."),$.ajax({method:"GET",url:"".concat(y.api,"account.php"),data:{token:z.token},success:function success(b){var c;try{c=JSON.parse(b)}catch(a){return console.error(a)}c.error&&(B.text("Account"),a(!0,c.error,"#ff5b5f"),setTimeout(a,8e3,!1),!Cookies.getJSON("account").email&&Cookies.remove("account")),B.text(c.username)},error:function error(){a(!0,"AJAX error","#ff5b5f"),B.text("Account"),setTimeout(a,8e3,!1)}})),A.on("click.flowshare",function(){a(!1)});var C=750>v,D=$("#search-results");$("#search-box").on("mouseenter mouseleave",function(a){"mouseenter"===a.type?c(!0):c(!1)});var E;$("#search-txt").on("blur",function(){setTimeout(function(){c(!1),D.css("padding","0").html("")},100)}),$("#search-txt").on("keyup focus",function(){var a=$(this).val()||"";return a.match(/^ *$/)?D.css("padding","0").html(""):void d(a)}),$("#search-box").on("submit",function(){e($("#search-txt").val())}),$("#search-btn").on("click",function(){e($("#search-txt").val())}),$("#header-account").on("click.flowshare",function(){var a=window.location.href;window.location.href=a.match(/\/home\/.*/)?"".concat(a.replace(/home\/.*/,""),"account/"):"".concat(a.split("/").slice(0,-1).join("/"),"/account/")});var F={sort:null,id:null,search:null},G={sort:{default:"new",display:!0,displayType:"filter",type:"string"},id:{default:void 0,display:!1,type:"int"},search:{default:void 0,display:!0,displayType:"search",type:"string"}},H=new URLSearchParams(window.location.search),I=$(".response");$.each(G,function(a,b){var c,d=H.get(a)||b.default;b.display?(c=g(a,d,b.displayType),!c&&g(a,b.default,b.displayType)):c=!0,b.default!==d&&c&&(F[a]=d)}),I.css("transition",".4s");var J=!0,K=1e3>v;1e3>v&&$("#nav-arrow").show(),$("nav .title").on("click",function(){i(J),J=!J}),$(".filter").on("click",".response",function(){var a=$(this);a.parent().children(".response").css("backgroundColor","transparent"),a.css("backgroundColor","#fdcb6e");var b=a.parent().attr("data-filter-name"),c=a.attr("data-filter-value"),d=G[b].default===c;d?delete F[b]:F[b]=c}),$("#apply-filters").on("click",function(){j(!0)});var L=0,M=[];F.search?l(F.search):k(F.sort);var N,O=$("#flow-list-container"),P=!1;x.on("scroll",function(){var a=x.prop("scrollHeight")-x.height()-x.scrollTop();200>a&&!P&&(L=15,F.search?l(F.search):k(F.sort),P=!0)}),u()});
//# sourceMappingURL=home.js.map