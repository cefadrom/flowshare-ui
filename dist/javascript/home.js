"use strict";$(function(){function a(a,b,c){return a?void B.text(b).css("backgroundColor",c).fadeIn():B.fadeOut()}function b(){D=750>w}function c(a){D&&G!==a&&(G=a,a?($("#logo-big, #header-account").fadeOut(200),$("#search-box").css({width:"280px",right:"calc((100% - 280px) / 2)"}),$("#search-txt").css("width","230px"),E.show(),setTimeout(function(){var a=$("#search-txt").trigger("focus").get(0);a.setSelectionRange(999999,999999)},100)):($("#logo-big, #header-account").fadeIn(200),$("#search-box").css({width:"auto",right:"120px"}).trigger("blur"),$("#search-txt").css("width","0"),E.hide()))}function d(a){function b(b,c){if($("#search-txt").val()===a)return E.css("padding","8px").html(""),c?E.append($("<div class=\"result\" style=\"cursor: default;\"></div>").text(c)):void($.each(b,function(a,b){E.append($("<div class=\"result\" data-flow-index=\"".concat(a,"\" data-flow-id=\"").concat(b.id,"\"></div>")).text(b.title))}),$(".result").off("flowshare.click").on("click.flowshare",function(){var a=F[$(this).attr("data-flow-index")],b=$(this).attr("data-flow-id");q(a,b)}))}return 31<a.length?b(null,"Text is too long"):void $.ajax({method:"GET",url:"".concat(z.api,"search.php?instant&text=").concat(encodeURI(a)),timeout:2e3,success:function success(a){var c;try{c=JSON.parse(a)}catch(a){return b(null,"JSON parse error")}return c.error?b(null,c.error):void(F=c,b(c))},error:function error(){b(null,"AJAX error")}})}function f(a){if(!a.match(/^[ ]*$/)){H.search=a;var b=new URLSearchParams;$.each(H,function(a,c){b.append(a,c)}),window.location.search=b.toString()}}function g(){$("#flow-search-back-arrow").off("click.flowshare").on("click.flowshare",function(){k(!0)})}function h(a,b,c){var d=!1;return"filter"===c?K.each(function(){$(this).attr("data-filter-value")!==b||($(this).parent().children(".response").css("backgroundColor","transparent"),$(this).css("backgroundColor","#fdcb6e"),d=!0)}):"search"==c&&($("#search-txt").val(b),d=!0),d}function i(){1e3>w?(j(!0),M=!0,$("#nav-arrow").show()):(j(!1),M=!1,$("#nav-arrow").hide()),L=100>$("nav").width()}function j(a){M&&(a?($("nav").css("height","60px"),$("#nav-arrow").removeClass("active")):($("nav").css("height","310px"),$("#nav-arrow").addClass("active")),setTimeout(v,400))}function k(a){var b=new URLSearchParams;delete H.search,$.each(H,function(a,c){null!==c&&b.append(a,c)}),a?window.location.search=b.toString():""===b.toString()?history.pushState({},"","./"):history.pushState({},"","?".concat(b.toString()))}function l(a){var b={offset:N};"rated"===a&&(b.rated=1),$.ajax({type:"GET",url:"".concat(z.api,"flows.php"),data:b,timeout:5e3,success:function success(a){if(n(a)){var b=n(a);O=O.concat(b),o()}},error:function error(){$("#flows-loading").html("Error when getting flows list: AJAX error<br>Please reload page or contact the site administrator.")}})}function m(a){$.ajax({type:"GET",url:"".concat(z.api,"search.php"),data:{text:a,offset:N},timeout:5e3,success:function success(b){if(n(b)){var c=n(b);O=O.concat(c),o("result(s)</span> for ".concat(a),!0,!0)}},error:function error(){$("#flows-loading").html("Error when getting flows list: AJAX error<br>Please reload page or contact the site administrator.")}})}function n(a){var b;try{b=JSON.parse(a)}catch(b){return $("#flows-loading").html("JSON Parse error<br>Error: <br>".concat(b,"<br>Response body:<br>").concat(a)),!1}return b.error?(Q.prepend("<i class=\"fas fa-chevron-circle-left back-arrow\" id=\"flow-search-back-arrow\" style=\"top: 5px; left: 5px\"></i>"),g(),$("#flows-loading").html("Error: ".concat(b.error)),!1):b}function o(a,b,c){var d=O;if(P=d,Q.text(""),a){var e=b?"".concat(d.length," "):"",f=c?"<i class=\"fas fa-chevron-circle-left back-arrow\" id=\"flow-search-back-arrow\"></i>":"";Q.append($("<div class=\"header\">".concat(f).concat(e).concat(a,"</div><hr>"))),c&&g()}$.each(d,function(a,b){var c=$("<div class=\"flow-container\"></div>").attr("data-flow-id",b.id).attr("data-flow-index",a);c.append($("<div class=\"flow-title\"></div>").text(b.title)),c.append($("<div class=\"flow-author\"></div>").text(b.user)),c.append($("<div class=\"flow-description\"></div>").text(b.description)),c.append($("<div class=\"flow-downloads\"></div>").append($("<i class=\"fas fa-download\"></i>").append($("<span class=\"number-container\"></span>").text(b.downloads)))),c.append($("<div class=\"flow-rating\"></div>").append($("<i class=\"far fa-star\"></i>").append($("<span class=\"number-container\"></span>").text(b.ratings)))),Q.append(c),$(".flow-container:odd").css("backgroundColor","#E5E5E5"),p()}),v()}function p(){$(".flow-container").off("click.flowshare").on("click.flowshare",function(){var a=parseInt($(this).attr("data-flow-index")),b=$(this).attr("data-flow-id"),c=P[a];q(c,b)})}function q(a,b){$("#flow-data").html("").append($("<i class=\"fas fa-chevron-circle-left back-arrow\" id=\"full-flow-data-back-arrow\"></i>")).append($("<div class=\"flow-title\"></div>").text(a.title)).append($("<div class=\"flow-author\"></div>").text(a.user)).append($("<div class=\"flow-description\"></div>").text(a.description)).append($("<div id=\"flow-data-bar\" style=\"margin-bottom: 20px\"></div>").append($("<div></div>").append($("<i class=\"fas fa-download\"></i>").append($("<span class=\"number-container\"></span>").text(a.downloads)))).append($("<div></div>").append($("<i class=\"far fa-star\"></i>").append($("<span class=\"number-container\"></span>").text(a.ratings)))).append($("<div id=\"download-button\"><i class=\"fas fa-file-download\"></i>  Download</div>")).append($("<div style=\"float: none\" id=\"review-button\"><i class=\"fas fa-user-plus\"></i>  Add review</div>"))).css("opacity",1).css("pointerEvents","all"),$("#download-button").off("click.flowshare").on("click.flowshare",function(){u(b,a.title)}),s(),Q.css("opacity",0),1e3>w&&$("nav").css("opacity",0),y.css("pointerEvents","none"),$("header").css("pointerEvents","all"),r(),$.ajax({url:"".concat(z.api,"reviews.php?view&id=").concat(b),method:"GET",timeout:4e3,success:function success(a){var b;try{b=JSON.parse(a)}catch(b){return t(null,a)}t(b)},error:function error(a){404===a.status||$("#flow-data").append($("<div class=\"rating-container\">Error when getting flow reviews : <br>AJAX error code ".concat(a.status,"</div>")))}}),H.id=b,k(!1)}function r(){$("#full-flow-data-back-arrow").off("click.flowshare").on("click.flowshare",function(){p(),$("#flow-list-container, nav").css("opacity",1),y.css("pointerEvents","all"),$("#flow-data").css("opacity",0).css("pointerEvents","none").html(""),delete H.id,k(!1)})}function s(){var a=$("#review-button");900>w||1e3<w&&1350>w?a.css("left","6%"):a.css("left","0")}function t(a,b){if(null!==a){var c=$("#flow-data");b&&c.append($("<div class=\"rating-container\">JSON Parsing error<br>Response body:<br>".concat(b,"</div>"))),"none"===y.css("pointerEvents")&&0<a.length&&(c.append($("<div style=\"position: relative; margin: 20px; font-size: 25px; font-weight: 600\">Ratings</div>")),$.each(a,function(a,b){c.append($("<div class=\"rating-container\"></div>").append($("<div class=\"rating-title\"></div>").text(b.username).append("1"===b.isedited?" <span style=\"opacity: .5; font-weight: lighter; margin-left: 10px\">(edited)</span>":"")).append($("<div class=\"rating-body\"></div>").text(b.comment)))}),$(".rating-container:even").css("backgroundColor","#E5E5E5"))}}function u(a,b){$.ajax({method:"GET",url:"".concat(z.api,"flows.php/id/").concat(a,"?data&base64"),timeout:1e4,success:function success(a){var c=document.createElement("a");c.setAttribute("href","data:application/octet-stream;charset=utf-8;base64,".concat(a)),c.setAttribute("download","".concat(b,".flo")),c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)},error:function error(a){alert("Download error : ".concat(a))}})}function v(){var a=$("footer"),b=$("nav"),c=b.position().top+(b.height()||200)+100,d=Q.position().top+(Q.height()||0)+100,e=Math.max(c,d);e<x-85?a.css({position:"absolute"}):a.css({position:"relative"})}var w=$(window).width(),x=$(window).height(),y=$("body"),z={homepage:"https://rasphost.com/flowshare/web/test/home/",homepageDir:"/flowshare/web/test/home/",api:"https://rasphost.com/flowshare/"};$(window).on("resize",function(){w=$(window).width(),x=$(window).height(),b(),i(),s(),v()});var A=Cookies.getJSON("account"),B=$("#header-account-popup"),C=$("#header-account-user");A&&A.token&&(C.text("Connecting..."),$.ajax({method:"GET",url:"".concat(z.api,"account.php"),data:{token:A.token},success:function success(b){var c;try{c=JSON.parse(b)}catch(a){return console.error(a)}c.error&&(C.text("Account"),a(!0,c.error,"#ff5b5f"),setTimeout(a,8e3,!1),!Cookies.getJSON("account").email&&Cookies.remove("account")),C.text(c.username)},error:function error(){a(!0,"AJAX error","#ff5b5f"),C.text("Account"),setTimeout(a,8e3,!1)}})),B.on("click.flowshare",function(){a(!1)});var D=750>w,E=$("#search-results");$("#search-box").on("mouseenter mouseleave",function(a){"mouseenter"===a.type?c(!0):c(!1)});var F,G=!1;$("#search-txt").on("blur",function(){setTimeout(function(){c(!1),E.css("padding","0").html("")},100)}),$("#search-txt").on("keyup focus",function(){var a=$(this).val()||"";return a.match(/^ *$/)?E.css("padding","0").html(""):void d(a)}),$("#search-box").on("submit click",function(a){console.log(a);var b=a.target.parentElement;("search-btn"===a.target.id||"search-btn"===b.id||"click"!==a.type)&&G&&f($("#search-txt").val())}),$("#header-account").on("click.flowshare",function(){var a=window.location.href;window.location.href=a.match(/\/home\/.*/)?"".concat(a.replace(/home\/.*/,""),"account/"):"".concat(a.split("/").slice(0,-1).join("/"),"/account/")});var H={sort:null,id:null,search:null},I={sort:{default:"new",display:!0,displayType:"filter",type:"string"},id:{default:void 0,display:!1,type:"int"},search:{default:void 0,display:!0,displayType:"search",type:"string"}},J=new URLSearchParams(window.location.search),K=$(".response");$.each(I,function(a,b){var c,d=J.get(a)||b.default;b.display?(c=h(a,d,b.displayType),!c&&h(a,b.default,b.displayType)):c=!0,b.default!==d&&c&&(H[a]=d)}),K.css("transition",".4s");var L=!0,M=1e3>w;1e3>w&&$("#nav-arrow").show(),$("nav .title").on("click",function(){j(L),L=!L}),$(".filter").on("click",".response",function(){var a=$(this);a.parent().children(".response").css("backgroundColor","transparent"),a.css("backgroundColor","#fdcb6e");var b=a.parent().attr("data-filter-name"),c=a.attr("data-filter-value"),d=I[b].default===c;d?delete H[b]:H[b]=c}),$("#apply-filters").on("click",function(){k(!0)});var N=0,O=[];H.search?m(H.search):l(H.sort);var P,Q=$("#flow-list-container"),R=!1;y.on("scroll",function(){var a=y.prop("scrollHeight")-y.height()-y.scrollTop();200>a&&!R&&(N=15,H.search?m(H.search):l(H.sort),R=!0)}),v()});
//# sourceMappingURL=home.js.map