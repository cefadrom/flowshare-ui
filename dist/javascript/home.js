"use strict";$(function(){function a(a,b,c){return a?void B.text(b).css("backgroundColor",c).fadeIn():B.fadeOut()}function b(){D=750>w}function c(a,b){(D||b)&&(a?($("#logo-big, #header-account").fadeOut(400),$("#search-box").css({width:"280px",right:"calc((100% - 280px) / 2)"}),$("#search-txt").css("width","230px"),E.show(),setTimeout(function(){var a=$("#search-txt").trigger("focus").get(0);a.setSelectionRange(999999,999999)},100)):($("#logo-big, #header-account").fadeIn(400),$("#search-box").css({width:"auto",right:"120px"}).trigger("blur"),$("#search-txt").css("width","0"),E.hide()))}function d(a){function b(b,c){if($("#search-txt").val()===a)return E.css("padding","8px").html(""),c?E.append($("<div class=\"result\" style=\"cursor: default;\"></div>").text(c)):void($.each(b,function(a,b){E.append($("<div class=\"result\" data-flow-index=\"".concat(a,"\" data-flow-id=\"").concat(b.id,"\"></div>")).text(b.title))}),$(".result").off("flowshare.click").on("click.flowshare",function(){var a=F[$(this).attr("data-flow-index")],b=$(this).attr("data-flow-id");p(a,b)}))}return 31<a.length?b(null,"Text is too long"):void $.ajax({method:"GET",url:"".concat(z.api,"search.php?instant&text=").concat(encodeURI(a)),timeout:2e3,success:function success(a){var c;try{c=JSON.parse(a)}catch(a){return b(null,"JSON parse error")}return c.error?b(null,c.error):void(F=c,b(c))},error:function error(){b(null,"AJAX error")}})}function e(a){if(!a.match(/^[ ]*$/)){G.search=a;var b=new URLSearchParams;$.each(G,function(a,c){b.append(a,c)}),window.location.search=b.toString()}}function f(){$("#flow-search-back-arrow").off("click.flowshare").on("click.flowshare",function(){j(!0)})}function g(a,b,c){var d=!1;return"filter"===c?J.each(function(){$(this).attr("data-filter-value")!==b||($(this).parent().children(".response").css("backgroundColor","transparent"),$(this).css("backgroundColor","#fdcb6e"),d=!0)}):"search"==c&&($("#search-txt").val(b),d=!0),d}function h(){1e3>w?(i(!0),L=!0,$("#nav-arrow").show()):(i(!1),L=!1,$("#nav-arrow").hide()),K=100>$("nav").width()}function i(a){L&&(a?($("nav").css("height","60px"),$("#nav-arrow").removeClass("active")):($("nav").css("height","310px"),$("#nav-arrow").addClass("active")),setTimeout(u,400))}function j(a){var b=new URLSearchParams;delete G.search,$.each(G,function(a,c){null!==c&&b.append(a,c)}),a?window.location.search=b.toString():""===b.toString()?history.pushState({},"","./"):history.pushState({},"","?".concat(b.toString()))}function k(a){var b={offset:M};"rated"===a&&(b.rated=1),$.ajax({type:"GET",url:"".concat(z.api,"flows.php"),data:b,timeout:5e3,success:function success(a){if(m(a)){var b=m(a);N=N.concat(b),n()}},error:function error(){$("#flows-loading").html("Error when getting flows list: AJAX error<br>Please reload page or contact the site administrator.")}})}function l(a){$.ajax({type:"GET",url:"".concat(z.api,"search.php"),data:{text:a,offset:M},timeout:5e3,success:function success(b){if(m(b)){var c=m(b);N=N.concat(c),n("result(s)</span> for ".concat(a),!0,!0)}},error:function error(){$("#flows-loading").html("Error when getting flows list: AJAX error<br>Please reload page or contact the site administrator.")}})}function m(a){var b;try{b=JSON.parse(a)}catch(b){return $("#flows-loading").html("JSON Parse error<br>Error: <br>".concat(b,"<br>Response body:<br>").concat(a)),!1}return b.error?(P.prepend("<i class=\"fas fa-chevron-circle-left back-arrow\" id=\"flow-search-back-arrow\" style=\"top: 5px; left: 5px\"></i>"),f(),$("#flows-loading").html("Error: ".concat(b.error)),!1):b}function n(a,b,c){var d=N;if(O=d,P.text(""),a){var e=b?"".concat(d.length," "):"",g=c?"<i class=\"fas fa-chevron-circle-left back-arrow\" id=\"flow-search-back-arrow\"></i>":"";P.append($("<div class=\"header\">".concat(g).concat(e).concat(a,"</div><hr>"))),c&&f()}$.each(d,function(a,b){var c=$("<div class=\"flow-container\"></div>").attr("data-flow-id",b.id).attr("data-flow-index",a);c.append($("<div class=\"flow-title\"></div>").text(b.title)),c.append($("<div class=\"flow-author\"></div>").text(b.user)),c.append($("<div class=\"flow-description\"></div>").text(b.description)),c.append($("<div class=\"flow-downloads\"></div>").append($("<i class=\"fas fa-download\"></i>").append($("<span class=\"number-container\"></span>").text(b.downloads)))),c.append($("<div class=\"flow-rating\"></div>").append($("<i class=\"far fa-star\"></i>").append($("<span class=\"number-container\"></span>").text(b.ratings)))),P.append(c),$(".flow-container:odd").css("backgroundColor","#E5E5E5"),o()}),u()}function o(){$(".flow-container").off("click.flowshare").on("click.flowshare",function(){var a=parseInt($(this).attr("data-flow-index")),b=$(this).attr("data-flow-id"),c=O[a];p(c,b)})}function p(a,b){$("#flow-data").html("").append($("<i class=\"fas fa-chevron-circle-left back-arrow\" id=\"full-flow-data-back-arrow\"></i>")).append($("<div class=\"flow-title\"></div>").text(a.title)).append($("<div class=\"flow-author\"></div>").text(a.user)).append($("<div class=\"flow-description\"></div>").text(a.description)).append($("<div id=\"flow-data-bar\" style=\"margin-bottom: 20px\"></div>").append($("<div></div>").append($("<i class=\"fas fa-download\"></i>").append($("<span class=\"number-container\"></span>").text(a.downloads)))).append($("<div></div>").append($("<i class=\"far fa-star\"></i>").append($("<span class=\"number-container\"></span>").text(a.ratings)))).append($("<div id=\"download-button\"><i class=\"fas fa-file-download\"></i>  Download</div>")).append($("<div style=\"float: none\" id=\"review-button\"><i class=\"fas fa-user-plus\"></i>  Add review</div>"))).css("opacity",1).css("pointerEvents","all"),$("#download-button").off("click.flowshare").on("click.flowshare",function(){t(b,a.title)}),r(),P.css("opacity",0),1e3>w&&$("nav").css("opacity",0),y.css("pointerEvents","none"),$("header").css("pointerEvents","all"),q(),$.ajax({url:"".concat(z.api,"reviews.php?view&id=").concat(b),method:"GET",timeout:4e3,success:function success(a){var b;try{b=JSON.parse(a)}catch(b){return s(null,a)}s(b)},error:function error(a){404===a.status||$("#flow-data").append($("<div class=\"rating-container\">Error when getting flow reviews : <br>AJAX error code ".concat(a.status,"</div>")))}}),G.id=b,j(!1)}function q(){$("#full-flow-data-back-arrow").off("click.flowshare").on("click.flowshare",function(){o(),$("#flow-list-container, nav").css("opacity",1),y.css("pointerEvents","all"),$("#flow-data").css("opacity",0).css("pointerEvents","none").html(""),delete G.id,j(!1)})}function r(){var a=$("#review-button");900>w||1e3<w&&1350>w?a.css("left","6%"):a.css("left","0")}function s(a,b){if(null!==a){var c=$("#flow-data");b&&c.append($("<div class=\"rating-container\">JSON Parsing error<br>Response body:<br>".concat(b,"</div>"))),"none"===y.css("pointerEvents")&&0<a.length&&(c.append($("<div style=\"position: relative; margin: 20px; font-size: 25px; font-weight: 600\">Ratings</div>")),$.each(a,function(a,b){c.append($("<div class=\"rating-container\"></div>").append($("<div class=\"rating-title\"></div>").text(b.username).append("1"===b.isedited?" <span style=\"opacity: .5; font-weight: lighter; margin-left: 10px\">(edited)</span>":"")).append($("<div class=\"rating-body\"></div>").text(b.comment)))}),$(".rating-container:even").css("backgroundColor","#E5E5E5"))}}function t(a,b){$.ajax({method:"GET",url:"".concat(z.api,"flows.php/id/").concat(a,"?data&base64"),timeout:1e4,success:function success(a){var c=document.createElement("a");c.setAttribute("href","data:application/octet-stream;charset=utf-8;base64,".concat(a)),c.setAttribute("download","".concat(b,".flo")),c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)},error:function error(a){alert("Download error : ".concat(a))}})}function u(){var a=$("footer"),b=$("nav"),c=b.position().top+(b.height()||200)+100,d=P.position().top+(P.height()||0)+100,e=Math.max(c,d);e<x-85?a.css({position:"absolute"}):a.css({position:"relative"})}var v=this,w=$(window).width(),x=$(window).height(),y=$("body"),z={homepage:"https://rasphost.com/flowshare/web/test/home/",homepageDir:"/flowshare/web/test/home/",api:"https://rasphost.com/flowshare/"};$(window).on("resize",function(){w=$(window).width(),x=$(window).height(),b(),h(),r(),u()});var A=Cookies.getJSON("account"),B=$("#header-account-popup"),C=$("#header-account-user");A&&A.token&&(C.text("Connecting..."),$.ajax({method:"GET",url:"".concat(z.api,"account.php"),data:{token:A.token},success:function success(b){var c;try{c=JSON.parse(b)}catch(a){return console.error(a)}c.error&&(C.text("Account"),a(!0,c.error,"#ff5b5f"),setTimeout(a,8e3,!1),!Cookies.getJSON("account").email&&Cookies.remove("account")),C.text(c.username)},error:function error(){a(!0,"AJAX error","#ff5b5f"),C.text("Account"),setTimeout(a,8e3,!1)}})),B.on("click.flowshare",function(){a(!1)});var D=750>w,E=$("#search-results");$("#search-box").on("mouseover",function(){c(!0)}).on("mouseout",function(){c(!1)});var F;$("#search-txt").on("blur",function(){setTimeout(function(){c(!1),E.css("padding","0").html("")},100)}),$("#search-txt").on("keyup focus",function(){var a=$(v).val();return a.match(/^[ ]*$/)?E.css("padding","0").html(""):void d(a)}),$("#search-box").on("submit",function(){e($("#search-txt").val())}),$("#search-btn").on("click",function(){e($("#search-txt").val())}),$("#header-account").on("click.flowshare",function(){var a=window.location.href;window.location.href=a.match(/\/home\/.*/)?"".concat(a.replace(/home\/.*/,""),"account/"):"".concat(a.split("/").slice(0,-1).join("/"),"/account/")});var G={sort:null,id:null,search:null},H={sort:{default:"new",display:!0,displayType:"filter",type:"string"},id:{default:void 0,display:!1,type:"int"},search:{default:void 0,display:!0,displayType:"search",type:"string"}},I=new URLSearchParams(window.location.search),J=$(".response");$.each(H,function(a,b){var c,d=I.get(a)||b.default;b.display?(c=g(a,d,b.displayType),!c&&g(a,b.default,b.displayType)):c=!0,b.default!==d&&c&&(G[a]=d)}),J.css("transition",".4s");var K=!0,L=1e3>w;1e3>w&&$("#nav-arrow").show(),$("nav .title").on("click",function(){i(K),K=!K}),$(".filter").on("click",".response",function(){var a=$(this);a.parent().children(".response").css("backgroundColor","transparent"),a.css("backgroundColor","#fdcb6e");var b=a.parent().attr("data-filter-name"),c=a.attr("data-filter-value"),d=H[b].default===c;d?delete G[b]:G[b]=c}),$("#apply-filters").on("click",function(){j(!0)});var M=0,N=[];G.search?l(G.search):k(G.sort);var O,P=$("#flow-list-container"),Q=!1;y.on("scroll",function(){var a=y.prop("scrollHeight")-y.height()-y.scrollTop();200>a&&!Q&&(M=15,G.search?l(G.search):k(G.sort),Q=!0)}),u()});
//# sourceMappingURL=home.js.map