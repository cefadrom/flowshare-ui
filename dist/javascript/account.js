"use strict";$(function(){function a(a){if($("#content").html(""),$(a).clone().css("display","block").appendTo("#content"),"#content-account"===a){var b=Cookies.getJSON("account");$("#content-account .title:first").text("Connected as ".concat(b.username))}"#content-upload"===a&&h(),"#content-daily"===a&&i()}function b(){1e3>j?(c(!0),o=!0,$("#nav-arrow").show()):(c(!1),o=!1,$("#nav-arrow").hide()),n=100>$("nav").height()}function c(a){o&&(a?($("nav").css("height","60px"),$("#nav-arrow").removeClass("active")):($("nav").css("height","310px"),$("#nav-arrow").addClass("active")))}function d(a){function b(a){p.html("");var b=Cookies.getJSON("account"),c=0===b.expires?void 0:{expires:b.expires},d=Object.assign(b,{email:a.email,username:a.username});Cookies.set("account",d,c),$("#content-account").clone().appendTo(p).show(),$("#content-account .title:first").html("Connected as ".concat(a.username,"<br>").concat(a.coins," sharecoins")),$("#account-logout").on("click.flowshare",function(){Cookies.remove("account"),e(null,a.email)})}if(p.html("<div id=\"loading-message\">Loading data...</div>"),m.css({cursor:"pointer",opacity:"1"}),l=!0,a)return b(a);var c=Cookies.getJSON("account");$.ajax({method:"GET",url:"".concat(k.api,"account.php"),data:{token:c.token},success:function success(a){var c;try{c=JSON.parse(a)}catch(b){return $("#loading-message").html("AJAX error: ".concat(b,"<br>Response body: ").concat(a))}return c.error?e(c.error):void b(c)},error:function error(){$("#loading-message").text("AJAX error. Please reload the page.")}})}function e(a,b){function c(a){i.fadeOut();var b;try{b=JSON.parse(a)}catch(b){return h("Error: ".concat(b,", response body: ").concat(a))}if(b.error)return h(b.error);if("OK"!==b.response)return h("An error occurs, response body: ".concat(JSON.stringify(a)));var c;$("#content-login #login-remember:checked").length&&(c={expires:365}),Cookies.set("account",{token:b.token,expires:c?365:0},c),d()}function h(a){return $(".error-msg:first").text(a),$("#login-mail").trigger("focus"),$("#login-password").val("")}p.html(""),m.css({cursor:"not-allowed",opacity:".6"}),l=!1,$("#content-login").clone().appendTo(p).show();var i=$("#content-login .mask:first");$("#login-mail").trigger("focus"),a&&h(a),!b&&Cookies.getJSON("account")&&(b=Cookies.getJSON("account").email),b?($("#login-mail").val(b),$("#login-password").trigger("focus")):$("#login-mail").trigger("focus"),$("#content-login").on("submit",function(){i.fadeIn(),$.ajax({method:"POST",url:"".concat(k.api,"login.php"),data:{email:$("#login-mail").val(),password:$("#login-password").val()},success:function success(a){c(a)},error:function(a){i.fadeOut(),h("AJAX error: response status ".concat(a.status,". Please try later or contact the administrator"))}})}),$("#content-login .additional-button").on("click.flowshare",function(){"token"===$(this).attr("data-ref")?f():g()})}function f(){function a(a){var c;try{c=JSON.parse(a)}catch(c){return b("Error: ".concat(c,". Response body: ").concat(a))}if(c.error)return b(c.error);if(!c.username)return b("Unknown error, please try again");var e;0<$("#content-login-token #token-remember:checked").length&&(e={expires:365}),console.log(e),Cookies.set("account",{token:$("#login-token").val(),username:c.username,expires:e?365:0},e),d(c)}function b(a){$(".error-msg:first").text(a),$("#login-token").trigger("focus")}p.html(""),m.css({cursor:"not-allowed",opacity:".6"}),l=!1,$("#content-login-token").clone().appendTo(p).show(),$("#login-token").trigger("focus");var c=$("#content-login-token .mask");$("#content-login-token").on("submit",function(){c.fadeIn(),$.ajax({method:"GET",url:"".concat(k.api,"account.php"),data:{token:$("#login-token").val()},timeout:5e3,success:function success(b){c.fadeOut(),a(b)},error:function error(a){c.fadeOut(),b("AJAX error : response code ".concat(a.status,". Please try later or contact the administrator"))}})}),$("#content-login-token .additional-button").on("click.flowshare",function(){e()})}function g(){function a(a){$(".error-msg:first").text(a),$("#register-password-1, #register-password-2").val(""),$("#register-email").trigger("focus")}p.html(""),m.css({cursor:"not-allowed",opacity:".6"}),l=!1,$("#content-register").clone().appendTo(p).show(),$("#register-email").trigger("focus"),alert("This functionality is WIP. Please create an account with the flowshare flow."),$("#content-register").on("submit",function(){var b={email:$("#register-email").val(),password:$("#register-password-1").val(),username:$("#register-username").val()};if(b.password!==$("#register-password-2").val())return a("The two passwords must be identical.")}),$("#content-register .additional-button").on("click.flowshare",function(){e()})}function h(){function a(a,b,c){function d(a){return a.error?g.text(a.error):void $("#content").html("<div id=\"loading-message\">Response: ".concat(a.response).concat(a.id?", flow id: ".concat(a.id):"","</div>"))}var e=Cookies.getJSON("account").token;f.fadeIn(),$.ajax({method:"POST",url:"".concat(k.api,"flows.php"),data:{title:a,description:b,data:c,base64:"",token:e,post:""},timeout:1e4,success:function success(a){f.fadeOut();var b;try{b=JSON.parse(a)}catch(b){return g.text("JSON parse error, response: ".concat(a))}d(b)},error:function error(a){f.fadeOut(),g.text("AJAX error, response code ".concat(a.status,", please try again."))}})}var b,c=$("#upload-title"),d=$("#upload-description"),e=$("#upload-flow"),f=$("#content-upload .mask"),g=$("#content-upload .error-msg");e.on("change",function(){var a=new FileReader,d=e.prop("files")[0];a.onload=function(){b=a.result.split(";base64,")[1],""===c.val()&&c.val(d.name.split(".flo")[0])},a.readAsDataURL(d)}),$("#content-upload").on("submit",function(){a(c.val(),d.val(),b)})}function i(){var a=$("#daily-button"),b=$("#content-daily .mask"),c=$("#content-daily .error-msg").css("padding-top","10px");a.on("click",function(){var a=Cookies.getJSON("account").token;b.fadeIn(),$.ajax({method:"POST",url:"".concat(k.api,"daily.php"),data:{token:a},timeout:5e3,success:function success(a){b.fadeOut();try{a=JSON.parse(a)}catch(b){return c.text("JSON parse error, response: ".concat(a))}return a.error?c.css("color","red").text(a.error):void c.css("color","#3bce38").text(a.response)},error:function error(a){b.fadeOut(),c.text("AJAX error, response code ".concat(a.status,". Please try later"))}})})}var j=$(window).width();$(window).on("resize",function(){j=$(this).width(),b()});var k={homepage:"https://rasphost.com/flowshare/web/test/home/",homepageDir:"/flowshare/web/test/home/",api:"https://rasphost.com/flowshare/"};$("#header-home").on("click.flowshare",function(){window.location.href=window.location.href.replace(/account\/.*/,"home/")});var l=!0,m=$(".category");$(".category:first").css("backgroundColor","#fdcb6e"),m.on("click.flowshare",function(){if(l){$(".category").css("backgroundColor","transparent"),$(this).css("backgroundColor","#fdcb6e");var b=$(this).attr("data-nav-value");b?a(b):console.error("Category is undefined")}}),setTimeout(function(){m.css("transition",".4s")},400);var n=!0,o=1e3>j;1e3>j&&$("#nav-arrow").show(),$("nav .title").on("click",function(){c(n),n=!n});var p=$("#content");p.html(""),Cookies.get("account")?d():e()});
//# sourceMappingURL=account.js.map